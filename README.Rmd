---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# SteadyStateBVAR

<!-- badges: start -->
<!-- badges: end -->

With this package the user can estimate the Steady-State BVAR(p) model by Mattias Villani, and also produce forecasts with the estimated model.

## Installation

You can install the development version of SteadyStateBVAR with:

```{r, message=FALSE, warning=FALSE, results='hide'}
remotes::install_github("markjwbecker/SteadyStateBVAR", force = TRUE, upgrade = "never")
```

## Example

Let us load the library and also load a Swedish macro data set.

```{r example, message=FALSE, warning=FALSE}
library(SteadyStateBVAR)
data("swe_macro")
```

The Swedish macro data set consists of CPIF inflation (pi), unemployment rate (u) and 3-month interest rate (R).

```{r}
plot.ts(Y)
```
The estimation period includes the Swedish financial crisis at the beginning of the 90s and the subsequent shift in monetary policy to inflation targeting. To accommodate this x_t (exogenous variables at time t) includes a constant term and a dummy for the pre-crisis period.

```{r}
bp = 27 #breakpoint at 1993Q4
dummy <- c(rep(1,bp), rep(0,nrow(Y)-bp)) #1 if t<=1993Q4, 0 if t>1993Q4
```

Now we do some setup. Since this is quarterly data, for simplicity, let us assume p=4 is a good choice.

```{r}
p=4
stan_data <- BVAR_setup(Y, p, det=c("c&d"), dummy=dummy) #c&d = constant and dummy
```

Now for the priors. We need to specify cross equation tightness (lambda1) and overall tightness (lambda2). Let us choose some common values lambda1=0.2 and lambda2=0.5. Futhermore, we need to specify the prior mean for the first own lag of the variables. For variables in differences, we set to zero (inflation) and for variables in levels (unemployment and interest rate) we set to 0.9 to reflect a persistent but stationary series.

```{r}
lambda1=0.2
lambda2=0.5
fol_pm=c(0, 0.9, 0.9)
```

Now to specify the prior for the steady states. The first column of Lambda represents the steady state in the latter regime. The second column of Lambda, determines the difference in steady states between the first and second regime.

```{r}
Lambda <- matrix(c(2, 4, #inflation
                   7,-3, #unemployment rate
                   1, 10),#interest rate
                   nrow=stan_data$m,
                   ncol=stan_data$d,
                   byrow=TRUE)
```

The prior on the constant terms in the steady-state VAR are thus centered on the perceived post-crisis steady state (column 1) and the prior on the dummy variable coefficients reflects the higher pre-crisis inflation and interest rates, and lower pre-crisis unmeployment rate (column 2).

Now we need to specify the prior variances for the steady state coefficients. Let us put a strong prior on inflation, since the Swedish central bank has a 2\% inflation target. For the other variables, we can just put unit variances. We assume prior independence of the steady states. Note that the variances are for the elements in vec(Lambda_pr_means).

```{r}
Lambda_pr_vars <- c(0.1, rep(1,5))
```

Now we input the above to the priors function and then attach the priors to the "stan_data".

```{r}
priors <- priors(Y, p, lambda1, lambda2, fol_pm, Lambda, Lambda_pr_vars)
stan_data <- c(stan_data, priors)
```

At last, we need to specify our forecast horizon, and also provide the fit function with the future exogenous variables. In this case, x_t' for all future periods will be (1,0), since we are not in t <= 1993Q4.

```{r}
H <- 40
X_pred <- cbind(rep(1, H), 0)
```

And now let us estimate the model (this will take some time).

```{r, results='hide'}
rstan_options(auto_write = TRUE)
options(mc.cores=parallel::detectCores())
fit <- estimate(stan_data, n_chains=4, iter=5000, warmup=2500, H=H, X_pred=X_pred)
```


And plot the forecasts along with the interval. Here I choose the mean as the forecast, but median is also possible. For the interval, I choose a 95\% prediction interval.

```{r forecast_plot, fig.width=10, fig.height=10}
# Standard plot
plot_forecast(fit, Y, ci=0.95, fcst_type="mean")
```
Now for the very special use case where the Steady-State BVAR model contains an inflation variable, on a quarterly frequency, where inflation (CPIF inflation in this case) is specified in terms of annualized quarterly rates of change

$$
400ln(CPI_t/CPI_{t-1})
$$
The plotting function has a method to directly plot the forecasts in terms of annual/yearly (not the same as annualized) inflation, which is the true target variable for central banks, i.e.

$$
100ln(CPI_t/CPI_{t-4})
$$
This allows the user to directly compare the inflation forecasts with the actual target variable of the central bank (yearly inflation).

The user just needs to specify "plot_annual_inf" to be "TRUE" and also specify which index in Y belongs to the inflation variable. Note again that for this to make sense, the inflation variable should be annualized quarterly rate of change in the price index, constructed with a difference in logarithms.
```{r, fig.width=10, fig.height=10}
# Annualized inflation plot for column 1
plot_forecast(fit, Y, ci=0.95, fcst_type="mean", plot_annual_inf=TRUE, inf_idx=1)
```