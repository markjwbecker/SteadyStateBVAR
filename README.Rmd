---
output:
  github_document:
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# SteadyStateBVAR

<!-- badges: start -->
<!-- badges: end -->

With this package the user can estimate the Steady-State BVAR(p) model by Mattias Villani.

## Installation

You can install the development version of SteadyStateBVAR with:

```{r, message=FALSE, warning=FALSE, results='hide'}
#remotes::install_github("markjwbecker/SteadyStateBVAR", force = TRUE, upgrade = "never")
```
## Introduction

The Steady State BVAR($p$) model is

$$
y_t = \Psi x_t + A_1(y_{t-1}-\Psi x_{t-1})+\dots+A_p(y_{t-p}-\Psi x_{t-p})+u_t
$$

where $y_t$ is a $k$-dimensional vector of time series at time $t$, and $x_t$ is a $q$-dimensional vector of deterministic variables, and $u_t \sim N_k(0,\Sigma_u)$ with independence between time periods. Also, $A_i$ for $i=1,\dots,p$ is $(k \times k)$, and $\Psi$ is $(k \times q)$. Note here that


$$
E(y_t)=\mu_t=\Psi x_t
$$

is the **steady state**. We can stack the $A$'s in the $(kp \times k)$ matrix $\beta$

$$
\beta=
\begin{bmatrix}
A'_1 \\ 
\vdots  \\
A'_p
\end{bmatrix}
$$

We can then rewrite the model as a nonlinear regression

$$
y_t' =x_t'\Psi' + \left[w_t'-q_t'(I_p \otimes \Psi') \right]\beta +u_t'
$$

where $w_t'=(y_{t-1}',\dots,y_{t-p}')$ is a $kp$-dimensional vector of lagged endogenous variables, and $q_t'=(x_{t-1}',\dots,x_{t-p}')$ is a $qp$-dimensional vector of lagged exogenous (deterministic) variables, $I_p$ is the $(p \times p)$ identity matrix and $\otimes$ denotes the Kronecker product. This is how the likelihood is written in the Stan code. The goal is to estimate $\beta, \Psi$ and $\Sigma_u$, therefore priors are needed. Starting with $\beta$, we use the Minnesota prior where


$$
\textrm{vec}(\beta) \sim N_{kpk}\left[\textrm{vec}(\beta_0),\Sigma_{\textrm{vec}(\beta)}\right]
$$

First for $\beta_0$, the Minnesota prior sets all elements to $0$, except for the elements that relate to the first own lags of the variables, which are often set to $0.9$ or $1$ for level variables or also to $0$ for growth rate variables. Further, $\Sigma_{\textrm{vec}(\beta)}$ is a diagonal matrix containing the prior variances for the elements in $\beta$. The prior is constructed such that for the autoregressive coefficient $A_{\ell}^{(i,j)}$ which is element $\left(i,j\right)$ of $A_{\ell}$ for $\ell=1,\dots,p,$ the prior variance is given by


$$
\textrm{Var}\left(A_{l}^{(i,j)}\right)=
\begin{cases}
\left(\frac{\lambda_1}{\ell}\right)^2 & \text{if } i = j \\
\left(\frac{\lambda_1 \lambda_2}{\ell}\right)^2 \frac{\sigma_i^2}{\sigma_j^2}& \text{if } i \neq j
\end{cases}
$$


Here $\lambda_1$ and $\lambda_2$ are scalar hyperparameters where the former is known as the overall tightness, and the latter as the cross-equation tightness. Furthermore, $\sigma_i^2$ is the $(i,i)$:th element of $\Sigma_u$, which we do not know, and therefore replace with an estimate. In this package, it is replaced by the least squares residual variance from a univariate autoregression for variable $i$ with $p$ lags (including any potential deterministic variables). Moving on to $\Psi$ the prior we use is


$$
\textrm{vec}(\Psi) \sim N_{kq}\left[\textrm{vec}(\Psi_0),\Sigma_{\textrm{vec}(\Psi)}\right]
$$

It is assumed that $\Sigma_{\textrm{vec}(\Psi)}$ is a diagonal matrix. At last, the prior for $\Sigma_u$ is


$$
\Sigma_u \sim IW(V_0,m_0)
$$

Here $V_0$ is the scale matrix and $m_0\geq k+2$ are the degrees of freedom. Since Stan does not allow the usual noninformative prior $\left|\Sigma \right|^{-(k+1)/2}$, we will instead specify an uninformative prior by setting $V_0=(m_0-k-1)\hat{\Sigma}_u$ where $\hat{\Sigma}_u$ is the least squares estimate from the VAR($p$) (including any potential deterministic regressors), and $m_0=k+2$.

## Example

We will now replicate the model in the empirical analysis in Section 4.1 in Villani (2009). First let us load the library and also load the data

```{r example, message=FALSE, warning=FALSE}
#remotes::install_github("markjwbecker/SteadyStateBVAR", force = TRUE, upgrade = "never")
library(SteadyStateBVAR)
data("villani2009")
yt <- xt #villani uses xt to denote the endogenous variables
```
The data set contains quarterly data for Sweden over the time period 1980Q1â€“2005Q4. The seven variables are: trade-weighted measures of foreign GDP growth $(\Delta y_f)$, CPI inflation $(\pi_f)$ and the 3-month interest rate $(i_f)$, the corresponding domestic variables ($\Delta y$, $\pi$ and $i$), and the level of the real exchange rate defined as $q=s+p_f-p$, where $p_f$ and $p$ are the foreign and domestic CPI levels (in logs) and $s$ is the (log of the) trade weighted nominal exchange rate. As such we have

$$
y_t=
\begin{pmatrix}
\Delta y_f \\
\pi_f \\
i_f \\
\Delta y \\
\pi \\
i \\
q
\end{pmatrix}
$$

The growth rate variables are specified in terms of quarterly rates of change, i.e. for a variable $z$, we have $100 \ln \left(\frac{z_t}{z_{t-1}}\right)$. To simplify the prior selection for the steady states later, we can multiply the growth rate series by $4$ to instead get annualized quarterly rates of change. We do that and then we can plot the data.

```{r, fig.width=8, fig.height=8}
growth_idx <- c(1, 2, 4, 5)
yt[, growth_idx] <- yt[, growth_idx] * 4
plot.ts(yt)
```

The estimation period includes the Swedish financial crisis at the beginning of the 90s and the subsequent shift in monetary policy to inflation targeting and flexible exchange rate. To accommodate this $x_t$ (deterministic variables at time $t$) includes a constant term and a dummy for the pre-crisis period, i.e.


$$
x_{t}' =
\begin{cases}
\begin{pmatrix}1 & 1\end{pmatrix} & \text{if } t \le 1992Q4 \\
\begin{pmatrix}1 & 0\end{pmatrix} & \text{if } t > 1992Q4
\end{cases}
$$

To formulate a prior on $\Psi$, note that the specification of $x_t$ implies the following parametrization of the steady state:


$$
\mu_t =
\begin{cases}
\psi_1 + \psi_2 & \text{if } t \le 1992Q4 \\
\psi_1 & \text{if } t > 1992Q4
\end{cases}
$$

where $\psi_i$ is the $i$:th column of $\Psi$.